# Game NPC LangGraph

一个基于 LangGraph 的多智能体示例项目，让玩家与多个 NPC (村长、铁匠、药师) 进行智能对话。

## ✨ 特性

- **🤖 智能路由**：AI自动根据对话内容选择最合适的NPC回答
- **💬 多轮对话**：支持连续对话，所有NPC都能看到完整的聊天历史
- **🎭 角色扮演**：每个NPC都有独特的人设和专业领域
- **🔄 上下文感知**：NPC能够参考之前的对话内容，提供连贯的回复
- **⚡ 即插即用**：基于requirements.txt，无需复杂的安装配置

## 🎮 NPC角色

- **🏛️ 村长**：村庄管理、历史故事、一般建议和信息
- **⚔️ 铁匠**：武器装备、打造修理、战斗相关
- **🌿 药师**：草药治疗、健康咨询、医疗相关

## 📦 安装

```bash
pip install -r requirements.txt
```

## 🚀 使用

```bash
export OPENAI_API_KEY="你的API Key"
python -m game_npc_langgraph.main
```

## 💬 多轮对话示例

```
🎮 欢迎来到 NPC 村落！（输入 quit 退出）
📋 可用的NPC角色：
   🏛️ 村长 - 村庄管理、历史故事、一般建议
   ⚔️ 铁匠 - 武器装备、打造修理
   🌿 药师 - 草药治疗、健康咨询
💡 提示：直接说话，系统会自动为你选择合适的NPC回答
📚 注意：所有NPC都能看到完整的对话历史
--------------------------------------------------

你: 我需要一把剑
铁匠: 哈！又有人需要武器了！我这里有几种剑可以选择：
长剑、短剑、还有我最新打造的符文剑。你想要哪种？
长剑适合正面战斗，短剑轻便好携带，符文剑有魔法加成但价格不菲。

你: 符文剑多少钱？
铁匠: 符文剑是我的得意之作！用的是上等精钢，镶嵌了火焰符文石。
一把要200金币，虽然贵了点，但绝对物有所值。攻击力比普通长剑高30%，
还自带火焰伤害。你要的话我还能免费帮你保养一年！

你: 好的，我要了。对了，用剑的时候需要注意什么？
铁匠: 好眼光！符文剑到手了。使用时记住几点：
1. 不要用剑身格挡重击，用剑刃侧面
2. 符文石怕水，别在雨天长时间使用
3. 定期用符文油保养，保持魔法效果
4. 感觉手柄发热就说明符文激活了，这时攻击力最强！

你: 谢谢！刚才试剑时不小心割伤了手，有什么药吗？
药师: 哎呀，让我看看伤口...嗯，不算太深。我刚好有适合的草药。
这是愈合草药膏，有止血和促进愈合的作用。涂抹后用干净布条包扎，
一天换两次药，三天就能完全愈合。记住不要碰水哦。
还有，刚买了新武器确实容易受伤，下次记得戴手套练习。

你: 村里还有什么有趣的地方吗？
村长: 孩子，看你刚买了铁匠的符文剑，又找药师治了伤，真是个勇敢的冒险者！
我们村里确实还有很多地方值得探索：
北边有古老的符文塔，传说里面藏着更强大的魔法知识；
南边的森林里有珍稀的草药，药师经常去那里采集；
还有东边的矿洞，铁匠的上等材料都是从那里来的。
不过要小心，最近有冒险者说在森林深处见到了奇怪的生物...

你: quit
👋 游戏结束，再见！
```

## 🏗️ 技术架构

- **LangGraph**：状态图管理对话流程
- **LangChain**：LLM调用和提示词管理  
- **OpenAI GPT**：驱动NPC对话的AI模型
- **TypedDict**：类型安全的状态管理
- **智能路由**：基于内容的NPC选择算法

## 🔧 核心组件

- `main.py` - 主游戏循环和状态图构建
- `npc_agents.py` - NPC角色定义和对话逻辑
- `router.py` - 智能路由器，选择合适的NPC
- `requirements.txt` - 项目依赖管理

## 🎯 开发说明

项目使用现代Python开发实践：
- 基于requirements.txt的依赖管理
- TypedDict提供类型安全
- 模块化设计，易于扩展新NPC
- 支持历史记录的上下文对话
